# 4장 저장된 데이터 보안
- 데이터 현지화(data localization): 데이터를 필요로 하는 서비스와 가까운 위치에 보관하는 것
- 마이크로서비스에서는 저장소를 분배해 운영하여 단일 장애지점(SPDF, Single Point Of Failure)이 될 가능성이 줄어든다
	- 데이터를 여러 곳에 나눠 저장하고 저장소 객체들을 서로 느슨하게 결합함
- 데이터 보안 달성 방법
	- 데이터 자체의 접근 차단(비인가자의 데이터 접근 차단)
	- 데이터 암호화(비인가자의 데이터 열람 차단)
- 데이터 분류
	- 저장하는 데이터별로 다른 보안 요구 사항을 가질 수 있음
	- AWS에서는 Tag를 사용해 데이터 분류 가능해짐
- 아마존 S3
	- AWS 관리형 서비스이기 때문에 물리적 리소스가 다른 클라우드 고객과 공유될 수 있음
	- 민감 데이터 보호 옵션
		- AWS IAM 정책을 사용해 리소스 접근 통제
		- KMS를 사용하여 버킷 내 저장된 객체 암호화
	- 암호화 방법
		- AWS 서버 측 암호화(AWS SSE-S3(https://docs.aws.amazon.com/ko_kr/AmazonS3/latest/userguide/UsingServerSideEncryption.html): AWS 관리형 키)
			- S3내 데이터 객체 암호화하는 디폴트 모드
			- CMK의 수명주기를 통제하지 않음
			- 데이터 키를 사용해 객체 암호화
				- 이 데이터 키는 KMS와 CMK로 암호화되며 AWS에서 CMK를 관리, 보호, 교체
		- AWS KMS 키를 통한 AWS 서버 측 암호화
			- KMS를 명시적으로 사용해 키를 관리 가능
		- 고객이 제공한 키를 사용한 AWS 서버 측 암호화(AWS SSE-C)
			- PutObject시 암호화키를 포함하여 제공
			- S3는 제공된 암호화키로 암호화해 저장한 다음 키를 영구 삭제함
		- 아마존 S3 클라이언트 측 암호화(S3전송 전 클라이언트에서 암호화)
	- 버킷 정책을 사용한 S3 접근 통제
	- GuardDuty
		- AWS CloudTrail과 S3 관리 이벤트를 확인해 S3 위협 모니터링
	- Glacier
		- 특정 정보에 대한 권위 있는 데이터 출처 역할을 기록 시스템(SOR, System Or Record)이 필요한 경우 Glacier 저장소 잠금(Vault Lock)을 사용하여 데이터 무결성과 신뢰성을 규제 준수 관점에서 인증받을 수 있는 방식으로 데이터 저장
		- 저장소 잠금
			- 잠금 ID 변환하여 정책의 유효성 검증
			- 장금 정책 변경 시 24시간 유효성 검증 기간 동안 잠금 프로세스 다시 시작 가능
### 컴퓨팅 서비스에 저장된 데이터 보안
- 컨테이너 보존을 위해 EC2 EBS 볼륨에 저장하는 경우 EBS 볼륨도 보호 대상에 포함됨
- CodeGuru
	- 정적 코드 분석
	- 코드를 샘플 저장소와 비교하고 머신러닝을 사용해 코드에서 보안 관련 문제점과 기타 모범 사례를 식별함
		- 리소스 누수(resource leak), 공격 도구 존재 여부, 취약점 식별 포함
- ECR
	- ECR에 이미지 저장시 얻는 3가지 이점
		- 접근 통제: IAM 정책으로 ECR 접근 통제 가능
		- 저장 암호화: KMS 사용하여 ECR에 저장된 컨테이너를 보호 가능
		- 이미지 스캔: Clair 사용해 컨테이너의 일반적이 취약점 스캔
- AWS 람다
	- 람다에 사용되는 환경 변수 암호화
		- CMK 사용하여 암호화
		- 암호화 도우미를 사용해 암호화
			- Encryption helper는 람다에 환경 변수 추가 전 클라이언트 측에서 환경 변수를 암호화함
			- AWS 콘솔에서 평문 형태로 노출하지 않음
- EBS
	- EC2에서 서비스 실행하는 경우 KMS 사용해 EBS 볼륨 암호화
### 마이크로서비스 데이터베이스 시스템
- 도메인별로 분리한 마이크로서비스 구조에서 각 도메인 별 DB를 선택해 사용
- DynamoDB
	- NoSQL 관리형 서버리스 데이터베이스 시스템
	- 접근 통제
		- IAM 정책 사용(칼럼, 레코드 지정 가능)
			- Condition으로 dynamodb:LeadingKeys(사용자 명), dynamodb:Attributes등 지정
	- 암호화
		- 서버측 암호화를 기본 제공함
		- 테이블의 데이터를 데이터 암호화키(DEK, Data Encryption Key)사용해 암호화하고 데이터 암호화키를 테이블 키를 사용해 암호화함
		- CMK 사용
			- AWS 소유 CMK (default): 여러 계정에서 공유해 사용
			- 고객 관리형 CMK
			- AWS 관리형 CMK: 특정 계정에서 사용
- Aurora RDBMS
	- 접근 보호
		- IAM 데이터베이스 인증
			- DB 내 신원이 AWS 계정 내 신원과 동기화됨. 
			- 다만, DB 인스턴스 클래스와 워크로드에 따라 DB 클러스터의 초당 최대 연결 수에 제한이 있을 수 있어 개인이 일시적으로 DB에 접근하기 위한 수단으로만 사용할 것을 권장
		- 비밀번호 인증
			- 전통적인 인증 유형
			- DB 사용자 명과 비밀번호 사용
	- 암호화
		- CMK로 암호화 가능
- 미디어와 데이터 삭제
	- 미디어 삭제(media sanitization): 기밀 데이터 저장 시 데이터를 안전하게 완전 삭제한 이후에 데이터 저장
		- 이 과정 거치지 않으면 잠재적으로 승인되지 않은 앱에 데이터가 노출될 가능성 있음
