# 8장 조직의 복잡성을 고려한 보안 설계
- 보안을 손상시키지 않으면서 팀과 직원들에게 가능한 많은 자율성과 유연성을 부여하는 것을 목표로 한다!
## 조직 구조와 마이크로서비스
- 리소스 공유와 권한을 통제하고 견제와 균형은 유지하되 자율성을 갖는 팀을 만드는데 도움이 되는 프로세스를 명확이 정의해야 한다.
- 콘웨이의 법칙
	- 모든 회사의 시스템 구조는 해당 구조를 설계하는 회사의 커뮤니케이션 구조를 닮는다
- 도메인 주도 설계
	- 조직의 팀 구조가 아닌 기능과 소비자 도메인에 기반을 두고 설계한 시스템을 개발함으로서 앱 디자인과 고객 요구 사항 간의 격차 해소
- 단일 팀 지향 서비스 아키텍쳐
	- 서비스와 도메인에 대한 명확한 소유권을 담당 팀에게 부여
- 역할 기반 접근 통제
	- 복잡한 구조의 조직일수록 적합.
	- RBAC(역할), ABAC(속성), MAC(강제적)
- **권한 상승**
	- 최소 권한의 원칙을 위배하지 않으면서 위급시 개발자 권한을 상승시키는 2가지 방법
	1. AWS Systems Manager 명령 실행
		- 잠재적 위협이 알려진 상황에서 사전에 작성해둔 스크립트 필요
		- 예를 들어 평소 개발자가 서버 재시작을 하지 못하지만 서버 재시작 bash script(SSM 문서)를 미리 작성하여 이 스크립트를 실행할 수 있는 역할을 위급시 위임하여 실행하도록 함.
		- 이 문서들은 데브옵스 팀에서 책임지고 관리
		- ABAC 모델을 적용해 rebootable tag가 달린 서버만 적용할 수도 있음
	2. 유리 깨기 모델(BTG, Break the Glass)을 사용
		- 예측할 수 없는 상황에서 사용
		- 리소스에 접근할 수 있는 권한이 없는 사람이 긴급 상황에서 높은 접근 권한을 빠르게 부여 받는 방법
		- 일시적이고 문제 해결 시 즉시 회수되어야 함
		- 모든 행위는 Cloudwatch, CloudTrail을 포함해서 기록되어야 함
		- 긴급 상황용 역할을 만들고 평소 회사 누구도 역할 수임 불가하도록 함
		- 긴급 상황용 역할을 수임할 수 있는 권한을 엔지니어링 부서에서 갖으나 자기 자신이 수임할 수 없음
		- 엔지니어링 부서 임원의 승인이 필수적
		- 일시적으로 긴급 상황용 관리자 역할의 신뢰 경계에 개발자를 추가하고 해소시 삭제함
- 권한 경계
	- PBY permissions boundary
	- 새로운 권한을 부여하지 않는 대신 수신 측이 가질 수 있는 최대 권한을 지정함
	- ex. iam user 생성 권한이 있어도 권한 경계에서 이를 허용하지 않으면 iam user를 생성할 수 없음
- 중앙 집중형 팀은 확장이 어려우며, 조직의 모든 신원을 제어할 수 있어 문제 소지가 있음
	- 일부 클라우드 관리 작업을 팀별 리더나 개발자에게 위임할 필요가 있음
	- 팀 리더가 iam 사용자를 생성하더라도 권한 경계가 그대로 위임되도록 강제할 수 있음 (CreateOrChangeOnlyWithBoundary 정책 사용)
	- 새로 생성된 사용자가 PBY를 변경/삭제할 수 없게 제한해야 함
## 대규모 조직을 위한 AWS 계정 구조
- 규모가 커진 단일 AWS 계정 내 사용자 관리는 악몽
- 주된 이슈는 폭발 반경
- 규제 준수 대상인 리소스와 아닌 리소스 분리 필요
- 따라서, 다중 계정 구조 채택!
	- 팀 별 자율성 보장
	- AWS Organizations 사용해 통제된 자율 환경 제공 가능
- 팀 별 AWS 계정 분리 이유
	- 보안 통제 (계정별 보안 정책 설정)
	- 피해 범위 격리
	- 자율성과 민첩성
	- 거버넌스
	- 위임
- 자율성 확보도 중요하지만 조직에는 견제와 균형도 필요
	- 내부 위협으로부터 보호할 수 있는 통제 수단 필요
	- AWS Organizations!
### AWS Organizations
- 관리 계정(최상위 계정 도입)
- 통합 결제 솔루션 적용
- 조직 단위 (OU, Organizational Unit): 조직 내 구성원이나 부서 등을 하나의 공통 그룹으로 분류하는 방법
	- 중첩도 허용
- 서비스 제어 정책 (SCP, Service Control Policies): 조직의 모든 계정과 조직 단위에 대한 권한을 통제
	- 개별 계정이나 조직 단위에서 부여할 수 있는 권한의 통제를 정의할 목적으로 사용
	- ex. 특정 태그 강제, 특정 유형(t3.small)의 리소스만 생성 하도록 강제, CloudTrail, CloudWatch 등 비활성화 거부, RAM을 사용해 리소스 외부에 공유하지 못하도록 차단 등
- 목적 기반 계정 (Purpose built account)
	- 여러 도메인에 영향을 미치는 공통 작업(cross-cutting task)
	- 로깅, 모니터링, 데이터 아카이빙, 암호화, 데이터 토큰화 등
- AWS Organizations 모범 사례
	- MFA (멀티팩터 인증) 활성화
- AWS Resource Access Manager
	- 계정별 리소스들이 서로 상호작용
	- 계정 내 특정 리소스를 다른 외부 계정과 공유할 수 있게 허용
- IAM Identity Center를 사용한 AWS SSO
	- 사용자가 한 곳에서 여러 계정과 앱에 쉽게 로그인할 수 있도록 함
	- AWS Organizations와 통함하여 사용할 수 있게 설계됨
	- 편의성을 희생하지 않으면서 신원 관리 및 클라우드 아키텍쳐를 단순화할 수 있음