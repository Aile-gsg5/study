# 1장 클라우드 기반 마이크로서비스 소개
## 개요
- 아키텍쳐 설계 단계에서 보안 통합 방법
- AWS에서 제공하는 도구 활용 방법
- 보안 관점에서 보안 시스템의 몇 가지 바람직한 특성을 가진 시스템을 만드는데 마이크로서비스가 어떻게 도움을 줄 수 있는지
- AWS가 마이크로서비스 설계하고 확장 보안 시스템을 구축하는데 어떻게 도움을 줄 수 있는지
## 클라우드 정보 보안의 기초
- 보안 기본 용어 정리
	- **취약점**: 시스템의 보안을 약화시키는 시스템의 모든 결함으로 공격자가 악용할 수 있다면 소프트웨어를 구성하는 모든 요소에 존재 가능
	- **위협**: 취약점을 악용하면 위협이 실현되었다고 한다
	- **악의적/위협 행위자, 위협 에이전트**: 취약점을 이용해 위협을 유발하는 모든 사람
	- **책임**: 보안 관점에서 위협이 결코 현실화되지 않게 보장할 책임이 누구에게 있는지 결점
	- **위험**: 손실을 초래할 수 있는 위협이 실현될 확률을 평가하는 지표
	- **통제/대책**: 위험의 합이나 위험을 일으킬 잠재적 위협의 부정적인 영향을 낮출 수 있는 모든 활동
## 위험과 보안 통제
- 보안 설계 프로세스: 조직의 총체적 위험을 줄일 목적으로 구현하는 통제 활동들을 식별하는 작업을 포함
- 위협 모델링(threat modeling): 잠재적인 위협을 식별하고 위협의 확률 및 영향을 줄이고자 선제적으로 대책을 구현하는 과정
- 무딘 보안 통제: 구체적인 내용을 파악하지 않고 일방적으로 모든 요처을 차단하는 보안 통제를 의미.
	- 강력하고 구현하기 쉽지만 정당한 사용자 간에 마찰을 일으키고 직원이 업무를 하지 못하도록 방해하기도 함
	- 5자에 이어서
- 예리한 통제: 비인가 요청만 식별하고 차단하는 통제
	- 적절하게 조정하는데 상당한 시간이 소요
	- 2장에 이어서
	- 경우에 따라 무딘 보안 통제와 예리한 통제가 모두 필요할 수 있음
- 일부 통제: 잠재적인 위협을 구체적인 대상으로 삼지 않으나 애플리케이션에서 위험의 합을 줄이는 효과를 가져옴
	- 예) 적절한 모니터링과 알림 체제 구현하여 보안 팀의 신속한 조치 가능해짐
- 탐지 통제(detective controls): 악의적인 행위자가 시스템을 공격하지 못하게 하도록 강력한 모니터링 시스템 구현
- CIS 벤치마크: 비영리 단체인 인터넷 보안센터에서 제공하는 보안 모범 사례
## 조직의 보안 정책
- 강력한 통제는 소프트웨어 엔지니어링 측면과 마찰이 존재할 수 있음
- 보안 정책: 보안 통제를 식별하고 구현하기 위한 좀 더 광범위한 비전을 제시하는 추상적인 계획
	- 조직에서 보안과 통제가 수행하는 역할을 정의
	- 목적: 대책 구현 비용과 잠재적 사고의 비용을 정량화하고 비교하는 것
	- 위협이 발생 가능한지, 타당한지, 현실화될 수 있는지를 고려하는 것이 중요
## 보안 사고와 보안의 3요소
- 보안 사고는 악의적인 행위자가 취약점을 악용해 잠재적인 위험이 실행될 때 발생
	- 모든 보안 사고는 보안의 3요소(기밀성, 무결성, 가용성)중 하나를 손상시킬 수 있다.
	- 보안의 3요소는 CIA Triad로 부르기도 함
- 보안의 3요소
	- **기밀성**(Confidentiality): 접근 권한이 없는 사람에게 데이터/정보가 노출/유출되는 보안 사고
	- **무결성**(integrity): 허가 받지 않은 시스템 변경이 지속돼 원하지 않는 상태를 발생시키는 보안 사고
	- **가용성**(Availability): 정상적인 작업을 수행하지 못하게 악의적인 행위자가 시스템을 장악하는 보안 사고
## AWS 공동 책임 모델
- AWS 공동 책임 모델을 이해하면 AWS가 자동으로 제공해주는 행동에 의존하지 않고 대책을 직접 제공해야 하는 잠재적 위협과 취약점을 식별하는 데 도움이 된다.
- AWS는 클라우드 보안에 대한 책임이 있음
	- AWS에서 제공하는 모든 서비스를 지원하는 인프라를 보호할 책임
	- 물리적인 보안도 포함됨
	- 다른 고객과 논리적으로 분리된 가상 환경에서 애플리케이션이 실행되게 할 책임
	- 단순한 물리적 인프라 보호하는 것 외 **AWS 관리형 서비스**의 경우 책임 범위가 달라진다
- 클라우드 환경의 애플리케이션 보안에 대한 책임은 고객에게 있음
	- 소프트웨어의 정기적인 패치, 접근 통제, 암호화, 인증 요구 사항 구현 등
## 클라우드 아키텍처와 보안
- 안전한 아키텍처 설계는 더 나은 보안 통제를 위한 조력자 역할을 함
- 보안 아키텍처의 원칙은 니콜라스 셔우드의 Enterprise Security Architecture 읽는 것을 추천
## 모듈화를 통한 보안
- 요즘 애플리케이션은 복잡하여 더 작고 관리하기 쉬운 모듈로 구성하는 것을 고려함
- 독립적으로 작업할 수 있는 더 작은 조각으로 나뉘고 이는 패치가 수월해 취약점 제거가 쉬워짐
## 단순화를 통한 보안
- 단순한 시스템은 복잡한 시스템보다 보호가 수월함
- 안전한 애플리케이션을 설계할 때의 가이드 원칙은 애플리케이션을 가능한 간단하게 만드는 것
## AWS의 완전 관리형 서비스를 통한 보안
- AWS는 관리형 서비스를 통해 더 많은 책임을 부담한다
- 예를 들어 RDS를 사용하면 AWS는 RDS를 구동하는 운영체제를 항상 최신 상태로 유지하고 발견된 모든 취약점을 제거할 책임이 있다.
- 보안 팀의 책임을 줄이고 조직의 확장에 집중할 수 있음
## 폭발 반경과 격리
- **폭발 반경**(blast radius): 가상의 위협 행위자가 영향을 미칠 수 있는 애플리케이션의 범위
	- 폭발 반경 최소화를 유지하기 위해 격리된 설계가 중요
## 심층 방어와 보안
- **심층 방어**(Defense-in-depth): 보안 시스템에서는 다층적이고 때로는 중복된 통제나 심지어는 한물간 통제가 단일 지점 솔루션보다 효과적
	- 보안 시스템은 개별 통제의 효율성을 독립적으로 평가하여 여러 통제의 존재가 중복으로 보일 수 있지마 심층 방어를 통해 통제의 존재와 사용을 정당화할 수 있다
## 경계 보호를 통한 보안
- 경계 보호 접근법에서 조직은 퍼블릭 인터넷으로 들어오는 모든 요청을 대상으로 한 강력한 방화벽을 만든다
- 조직의 데이터센터나 VPN으로 연결된 네트워크 등 신뢰 경계 내에 있는 사용자나 서비스는 신뢰받기 때문에 추가 인증 계층을 거치지 않는다
## 제로 트러스트 아키텍처를 통한 보안
- 외부 뿐 아니라 내부의 공격자가 조직에 심각한 위협을 가할 수 있음
- **제로 트러스트 아키텍처**(Zero trust architecture): 애플리케이션의 위협이 조직 내/외부를 가리지 않고 어디에나 존재한다고 가정
- 모든 자원을 개별 보호하는 방안을 고려해야 함
	- 8장에서 AWS가 제공하는 Zero Trust 아키텍처 구현에 도움을 주는 도구 소개
## 소프트웨어 아키텍처에 대한 간략한 소개
- 마이크로서비스 설계의 기본
### 계층형 아키텍처
- 사용자 인터페이스 구성, 애플리케이션 관리, 데이터 관리 기능을 서로 분리하는 것을 목표로하며, 단순성, 친숙함, 저비용 등의 장점이 있음
- 단점은 민첩성과 확장성 부족
### 도메인 주도 설계
- **도메인 주도 설계**(DDD, Domain-Driven Design): 모든 소프트웨어 프로그램은 사용자나 비즈니스 기능의 일부 활동이나 관심사와 관련 있다고 가정
- 애플리케이션 로직을 기능적 도메인에 연결함으로서 비즈니스 및 기능 단위에 맞춰 조정하는 방식으로 애플리케이션을 분할할 수 있음
- 같은 비즈니스 도메인의 기능을 처리하는 서비스는 서로 밀접한 관계를 가질 가능성이 높으므로 함께 그룹화하는 것이 타당함
- 콘텍스트 내부의 모든 서비스는 외부의 모든 서비스와 느슨한 관계를 가져야 함
### 결합도와 응집도
- 결합도(Coupling): 경계 콘텍스트 간의 상호 의존성으로 한 콘텍스트의 서비스가 다른 콘텍스트의 서비스와 밀접하게 관련 있는지 식별
- 응집도(Cohesion): 경계 콘텍스트 내에서 서비스가 얼마나 관련돼 있는지 측정
### 마이크로서비스
- 특징
	- 독립적인 배포
		- 애플리케이션의 나머지 부분에 영향을 주지 않고 업그레이드, 패치 또는 삭제할 수 있다
	- 독립적인 확장
		- 부하가 발생하는 경우 나머지 부분에 영향을 주지 않고 개별 마이크로서비스를 확장하거나 축소할 수 있다
	- 느슨한 결합
		- 개별 마이크로서비스에 대한 성능 저하나 변경이 나머지 부분에 영향을 미치지 않아야 한다
	- 도메인 주도
		- 모듈화하고 속한 비즈니스 도메인에 따라 콘텍스트로 그룹화
	- 단일 비즈니스 작업 담당
		- 마이크로서비스는 단일 책임 원칙(SRP, Single Responsibility Principle)을 따라야 한다
- 개별 마이크로서비스가 어느 정도 규모로 커져야 하는지 파악해야 함
- 단일책임 원칙은 모든 마이크로서비스가 단일 애플리케이션 기능만 포함해 캡슐화 할 것을 제안
	- 필수 기능만 포함하고 가벼우며 이해가 쉬워지는 효과
- 마이크로서비스의 공식적인 정의가 보안 설계 패턴 실현에 도움을 주는 이유
	- 모듈화를 통한 보안
		- 소규모 모듈형 서비스로 구성돼 보안 통제 구현이 쉬움
	- 단순화를 통한 보안
		- 작고 단일 책임 원칙을 따라 단순성 목표를 달성하는 것이 쉬움
	- 격리를 통한 보안
		- 도메인 주도 설계를 따라 격리된 환경을 구성하는 것이 더 쉬움
	- 제로 트러스트 아키텍처를 통한 보안
		- AWS 공동 책임 모델을 잘 활용하고 세분화된 통제를 사용한다면 구현하는 것이 더 쉬움
## AWS에서 마이크로서비스 구현
- 실제 구현할 때 따라야 하는 규칙은 없음
- 모듈화하고 모듈을 느슨하게 결함해 다른 서비스에 영향을 주지 않고 교환, 업그레이드, 대체 또는 확장할 수 있게 하는 것은 중요
- 업계에서는 2가지 방법을 채택하여 마이크로서비스 구현
	- 컨테이너 기반 접근법
		- 경량화, 독립화한 컨테이너로 캡슐화해 컨테이너 엔진의 상위에서 실행되게 만듬
	- FaaS 기반 접근법
		- 비즈니스 기능을 FaaS 플랫폼에서 직접 실행함
	- 두 방법 모두 확장성과 보안 관점에서 장점과 한계가 있음
	- 이 책에서는 AWS가 제공하는 도구를 활용해 컨테이너 기반과 FaaS 기반 접근법에 대한 보안을 강화하는 방법을 중점적으로 설명
### 컨테이너 기반 마이크로서비스 아키텍처
- 종속성과 모든 비즈니스 로직을 가볍고 이식 가능하며 배포 가능한 컨테이너에 패키징
- 보안 관점에서 비즈니스 로직을 격리하고 컨테이너화 하는 역할을 도커 엔진에 크게 의존한다.
- 브레이크아웃 취약점(breakout vulnerability): 한 컨테이너의 서비스가 다른 컨테이너 또는 호스트 운영체제를 방해할 수 있는 모든 취약점
	- 방지를 위해 컨테이너를 실행하는 엔진의 최신 버전을 실행하는 것이 중요
### 쿠버네티스의 매우 간략한 소개
- 여러개의 컨테이너 기반 마이크로서비스를 실행할 수 있다
- 실행 상태를 유지해야 할 개별 서비스의 스펙이 정의한 설정을 기반으로 오케스트레이션함
- 파드(pod): 가장 기본적인 실행 단위
- 컨트롤 플레인(control plane): 클러스터에서 파드의 오케스트레이션을 관리하고 용이하게 하는 것
- AWS는 2가지 관리형 옵션을 제공함
	- 아마존 EKS (Elastic Kubernetes Service)
	- 아마존 EKS Fargate 모드 (Elastic Kubernetes Service, Fargate Mode)
### 서비스형 함수: AWS 람다를 사용한 FaaS
- 고객이 컨테이너화나 패키징을 사용하지 않고 비즈니스 로직을 실행할 수 있는 환경 제공
- 컨테이너 보안, 노드 실행, 오케스트레이션 설정 보안에 대해 걱정할 필요 없음
### 클라우드 마이크로서비스 구현 개요
- 마이크로서비스 환경에서 보안 사고가 발생할 만한 많은 지점을 예상할 수 있음
- 계층별 의미와 비인가 접근을 하는 방법
	- 비즈니스 로직
		- 함수 또는 애플리케이션 로직으로 불리는 핵심 비즈니스 기능을 실행하는 애플리케이션 코드
		- 코드 탈취 조심
	- 런타임 환경(컨테이너 환경)
		- 샌드박스 환경에서 애플리케이션 로직을 실행하는 환경이라 런타임을 격리하고 마이크로서비스 폭발 반경 최대 범위를 포함함
		- 컨테이너 버전을 최신 상태로 유지하고 런타임의 오래된 취약점을 패치하는 것이 애플리케이션 보호에 중요
	- 컨테이너 런타임(컨테이너 엔진)
		- 런타임 환경에서 컨테이너를 실행할 수 있는 소프트웨어
		- 가상화 계층의 보안 취약점이 호스트 운영체제나 동일 시스템에서 실행 중인 다른 컨테이너에 영향을 미치지 않게 하는 것이 중요
		- 런타임을 지속적으로 업데이트하는 것이 중요
	- 가상 머신(VM, Virtual Machine)
		- 컨테이너 엔진을 실행할 가상의 시스템
		- 운영체제 수준의 취약점 관리 필요
	- 물리적인 하드웨어
		- 서비스를 실행하는데 필요한 컴퓨팅 능력을 제공할 수 있음
		- 도난, 물리적 파손, 플래시 드라이브나 물리적 장치를 사용한 해킹에 취약
	- 컨테이너 저장소
		- 이미지 변조 조심
	- 컨테이너 오케스트레이션
		- 오케스트레이터는 트래픽에 맞게 서비스의 확대 축소
## 아마존 EKS
- 컨트롤 플레인은 런타임 서비스가 스펙에 따라 작동하는 것을 보장하여 앱의 가용성을 지속적으로 제어
- AWS는 아마존 EKS에서 컨트롤 플레인을 완전 관리형으로 고객에게 제공
	- 여전히 안전하게 하는 설정을 적용하고 보호할 책임은 고객에게 있음
- AWS는 악의적인 행위자가 컨트롤 플레인을 장악하는 위험을 완화시키나 노드에 대한 책임은 고객에게 있음
## 아마존 EKS Fargate 모드
- 노드를 책임 져야 하는 부담을 AWS에 위임
- 컨테이너 자체와 이러한 컨테이너에서 실행되는 비즈니스 로직에 대한 책임은 여전히 고객에게 있음
## AWS 람다를 사용한  서비스형 함수
- AWS 람다는 대부분의 통제를 구현하는 책임이 AWS에 있으나, 고객은 여전히 AWS가 고객 대신 보안을 활성화 할 수 있도록 접근을 설정하고 네트워크 통제 및 기타 설정을 해야 함
- AWS는 샌드박스 환경에서 서버를 프로비저닝하고 코드를 실행할 책임이 있음
## 마이크로서비스 구현 요약
![[Pasted image 20240518154508.png]]
## 마이크로서비스 통신 패턴 예
- 통신 경로는 모든 애플리케이션의 가장 취약한 지점이기 때문에 서비스간 통신은 애플리케이션 위험의 합을 증가시킴
- **예제 1. 콘텍스트 간 단순 메시지 전달**
	- HTTP 요청이 일반적
	- 동기식 REST 엔드포인트 사용
	- 마이크로서비스의 동기식 통신 사용은 만류한다 (느슨한 결합을 만족시키지 못함)
- **예제 2. 메시지 큐**
	- 비동기적
	- 어떤 생산자도 하위 소비자를 기다리지 않으며, 하위 소비자가 생산자의 신뢰성에 영향을 주지 않음
	- 보안 전문가는 메시지 큐와 서비스 A, B 엔드포인트 모두를 보호해야 함
- **예제 3. 이벤트 기반 마이크로서비스**
	- 모든 상태 변경 명령이 이벤트를 발생시키고 해당 이벤트를 이벤트 브로커가 앱의 다른 부분으로 브로드캐스팅한다는 전제하에 작동
	- 다른 콘텍스트의 서비스는 이러한 이벤트를 구독하여 변경사항을 반영
## 요약
- 위협과 위험의 기본 개념 소개
- 통제와 대책의 개념 설명
- 클라우드 보안의 핵심은 책임 구분 개념과 누구에게 책임이 있는지 이해하는 것
